# 🎨 LUNUS AI 이미지 검색 시스템 실행 가이드

이 가이드는 **비개발자도 쉽게** LUNUS 프로젝트에 AI 이미지 검색 기능을 추가할 수 있도록 작성되었습니다.

---

## 📋 전체 과정 요약

1. ✅ **Replicate API 토큰 발급** (5분)
2. ✅ **환경 변수 설정** (2분)
3. ✅ **패키지 설치** (3분)
4. ✅ **Supabase 데이터베이스 설정** (5분)
5. ✅ **제품 이미지 벡터화 실행** (1~2시간, 자동)
6. ✅ **테스트 및 확인** (5분)

**총 소요 시간**: 약 20분 (벡터화는 자동으로 진행)

---

## 🔑 Step 1: Replicate API 토큰 발급

Replicate는 AI 모델을 쉽게 사용할 수 있게 해주는 서비스입니다.

### 1-1. Replicate 회원가입
1. **웹 브라우저**에서 https://replicate.com 접속
2. 우측 상단 **"Sign up"** 버튼 클릭
3. **GitHub** 또는 **Google** 계정으로 가입 (무료)

### 1-2. API 토큰 생성
1. 로그인 후 우측 상단 **프로필 아이콘** 클릭
2. **"Account Settings"** 클릭
3. 좌측 메뉴에서 **"API tokens"** 클릭
4. **"Create token"** 버튼 클릭
5. 토큰 이름 입력 (예: `lunus-image-search`)
6. 생성된 토큰 **복사** (한 번만 보여지므로 꼭 복사!)
   - 토큰은 `r8_` 로 시작하는 긴 문자열입니다

---

## ⚙️ Step 2: 환경 변수 설정

### 2-1. @env.txt 파일 수정
1. **VSCode**에서 프로젝트 루트 폴더의 `@env.txt` 파일 열기
2. **맨 아래** 부분에 다음 내용이 있습니다:
   ```
   REPLICATE_API_TOKEN=r8_여기에_발급받은_토큰을_붙여넣으세요
   ```
3. `r8_여기에_발급받은_토큰을_붙여넣으세요` 부분을 **Step 1에서 복사한 토큰**으로 교체
4. **저장** (Ctrl+S 또는 Cmd+S)

### 2-2. .env.local 파일에 복사
1. `@env.txt` 파일의 **전체 내용을 복사**
2. 프로젝트 루트 폴더의 `.env.local` 파일을 열기
3. **전체 내용을 붙여넣기** (기존 내용 덮어쓰기)
4. **저장**

---

## 📦 Step 3: 패키지 설치

### 3-1. PowerShell 터미널 열기
1. **VSCode** 하단의 **터미널 패널** 확인
2. 없다면: 상단 메뉴 → **Terminal** → **New Terminal**

### 3-2. 패키지 설치 명령어 실행
터미널에 다음 명령어를 **차례대로** 입력하고 **Enter**:

```powershell
npm install
```

⏳ **약 1~2분 소요**됩니다. 설치가 완료될 때까지 기다려주세요.

---

## 🗄️ Step 4: Supabase 데이터베이스 설정

### 4-1. Supabase Dashboard 접속
1. 웹 브라우저에서 https://supabase.com 접속
2. 로그인 (이미 계정이 있어야 합니다)
3. **LUNUS 프로젝트** 선택

### 4-2. SQL 마이그레이션 실행
1. 좌측 메뉴에서 **"SQL Editor"** 클릭
2. **"New Query"** 버튼 클릭
3. VSCode에서 `supabase_vector_migration.sql` 파일 열기
4. **전체 내용을 복사**
5. Supabase SQL Editor에 **붙여넣기**
6. 우측 하단 **"Run"** 버튼 클릭

✅ **성공 메시지**가 나타나면 완료!

### 4-3. 진행 상황 확인 (선택적)
SQL Editor에서 다음 쿼리를 실행하여 확인:

```sql
SELECT * FROM vectorization_progress;
```

현재 벡터화된 제품 수를 확인할 수 있습니다.

---

## 🎨 Step 5: 제품 이미지 벡터화 실행

이제 모든 제품 이미지를 AI가 분석하여 벡터로 변환합니다.

### 5-1. 벡터화 스크립트 실행
터미널에서 다음 명령어 입력:

```powershell
npm run vectorize
```

### 5-2. 진행 상황 확인
스크립트가 실행되면 다음과 같은 화면이 나타납니다:

```
🚀 LUNUS 이미지 벡터화 시작

============================================================
설정:
  - 배치 크기: 50개
  - API 호출 간격: 1000ms
  - 최대 재시도: 3회
============================================================

📊 전체 제품 수: 1234개
✓ 이미 처리된 제품: 0개
⏳ 남은 제품: 1234개

============================================================
📦 배치 1: 50개 제품 처리 중...
============================================================
  [1/50] 처리 중: 일룸 소프토 패브릭 침대...
    🔗 URL: https://...
    ✓ 성공! (벡터 차원: 512)
    📊 전체 진행률: 1/1234 (0.1%)
```

### 5-3. 소요 시간
- **제품 1,000개**: 약 1~2시간
- **제품 100개**: 약 10~15분

⚠️ **주의사항**:
- 스크립트가 실행 중일 때는 **터미널을 닫지 마세요**
- 컴퓨터를 **절전 모드로 두지 마세요**
- 도중에 멈추더라도 **재실행하면 이어서 진행**됩니다

### 5-4. 완료 확인
스크립트가 완료되면 다음과 같은 메시지가 나타납니다:

```
============================================================
🎉 벡터화 완료!
============================================================
✅ 성공: 1230개
❌ 실패: 4개
⏱️  소요 시간: 95.3분
⚠️  실패 목록: vectorization-failed.json
============================================================
```

---

## ✅ Step 6: 테스트 및 확인

### 6-1. 개발 서버 실행
터미널에서:

```powershell
npm run dev
```

### 6-2. 사진 검색 기능 테스트
1. 브라우저에서 http://localhost:3000 접속
2. 하단 네비게이션에서 **"돋보기 아이콘"** (사진 검색) 클릭
3. **"사진 올리기"** 버튼 클릭
4. 가구 사진 선택
5. **"이 사진으로 검색하기"** 버튼 클릭
6. ⏳ 약 3~5초 후 **유사한 제품들이 표시**됩니다!

### 6-3. 제품 상세페이지 확인
1. 메인 페이지에서 아무 제품이나 **클릭**
2. 제품 상세 페이지 하단에 **"이 제품과 비슷한 상품"** 섹션이 표시됩니다
3. **AI가 자동으로 추천**한 유사 제품들을 확인할 수 있습니다

---

## 🎯 완료!

축하합니다! 🎉 이제 LUNUS 프로젝트에 AI 이미지 검색 기능이 추가되었습니다.

---

## ❓ 문제 해결 (Troubleshooting)

### ❌ "REPLICATE_API_TOKEN not configured" 에러
**원인**: API 토큰이 설정되지 않음
**해결**:
1. `@env.txt` 파일에 토큰이 제대로 입력되었는지 확인
2. `.env.local` 파일에 내용이 복사되었는지 확인
3. 개발 서버를 **재시작** (터미널에서 Ctrl+C 후 `npm run dev`)

### ❌ "Rate limit exceeded" 에러
**원인**: Replicate API 호출 한도 초과
**해결**:
- **5~10분 후** 다시 시도
- 벡터화 스크립트의 경우 자동으로 재시도됩니다

### ❌ "Product not vectorized" 에러
**원인**: 해당 제품이 아직 벡터화되지 않음
**해결**:
- 벡터화 스크립트(`npm run vectorize`)가 **완료되었는지** 확인
- Supabase에서 진행 상황 확인:
  ```sql
  SELECT * FROM vectorization_progress;
  ```

### ❌ 벡터화 스크립트가 멈춤
**원인**: 네트워크 문제 또는 API 오류
**해결**:
1. 터미널에서 **Ctrl+C**로 스크립트 중단
2. 다시 `npm run vectorize` 실행
3. 이미 처리된 제품은 자동으로 **스킵**됩니다

### ❌ 이미지가 표시되지 않음
**원인**: 이미지 URL 접근 불가
**해결**:
- 네트워크 연결 확인
- 브라우저 콘솔에서 에러 메시지 확인

---

## 💰 비용 안내

### Replicate API 비용
- **무료 크레딧**: 신규 가입 시 $0.10 제공
- **종량제**: $0.0005 ~ $0.001 per prediction
- **예상 비용**:
  - 1,000개 제품 벡터화: **약 $5~10** (일회성)
  - 일일 100개 신규 제품: **약 $0.05~0.10/일**
  - 사용자 검색 1,000회/일: **약 $0.50~1.00/일**

### Supabase 비용
- **pgvector 저장**: 무료 (저장 공간만 필요)
- **10,000개 제품**: 약 20MB (무시 가능)
- **Free Tier**: 500MB까지 무료

---

## 📚 추가 리소스

- **Replicate 문서**: https://replicate.com/docs
- **Supabase pgvector 가이드**: https://supabase.com/docs/guides/ai/vector-columns
- **CLIP 모델 정보**: https://github.com/openai/CLIP

---

## 🆘 도움이 필요하신가요?

문제가 해결되지 않으면:
1. 에러 메시지 **스크린샷** 찍기
2. `vectorization-log.json` 파일 확인
3. 개발자에게 문의

---

**작성일**: 2025년 10월 11일  
**버전**: 1.0  
**프로젝트**: LUNUS AI Image Search


